<!-- Post create/edit form template.
     Tailwind for styling, Angular reactive forms for state/validation. 
-->

<section class="max-w-2xl mx-auto space-y-4 space-y-6">
  <!-- Title switches depending on whether we have an id (edit) or not (create) -->
  <h1 class="text-2xl font-bold">{{ id ? 'Edit post' : 'New post' }}</h1>

   <!-- Bind the reactive form and handle submit via (ngSubmit) -->
  <form [formGroup]="form" (ngSubmit)="submit()" class="space-y-3">
    <div>
      <label class="block text-sm text-gray-500">Title</label>
      <!-- Form control is wired to 'title' field in the FormGroup -->
      <input formControlName="title" class="border rounded px-3 py-2 w-full">
      <!-- Show a tiny error only after the field was touched and is invalid -->
      <div class="text-red-600 text-sm" *ngIf="form.controls.title.touched && form.controls.title.invalid">
        Title is required
      </div>
    </div>

    <div>
      <label class="block text-sm text-gray-500">Content</label>
      <!-- Same idea for the 'content' field -->
      <textarea formControlName="content" rows="8" class="border rounded px-3 py-2 w-full"></textarea>
      <div class="text-red-600 text-sm" *ngIf="form.controls.content.touched && form.controls.content.invalid">
        Content is required
      </div>
    </div>

    <div>
      <!-- Categories are predefined (seeded) and many-to-many with posts -->
      <div class="text-sm text-gray-500 mb-1">Categories</div>
      <!-- Render a checkbox per category.
        We DON'T bind ngModel here; we derive checked state from the form value
        and update the form manually via toggleCat(id, checked) to keep things simple. 
      -->
      <label *ngFor="let c of categories" class="mr-4 inline-flex items-center gap-2">
        <input type="checkbox"
               [checked]="form.value.categories?.includes(c.id) || false"
               (change)="toggleCat(c.id, $any($event.target).checked)">
        <span>{{ c.name }}</span>
      </label>
    </div>

    <!-- Disable the button while weâ€™re saving to prevent double submits -->
    <div class="flex gap-2 items-center">
      <button [disabled]="loading" class="px-4 py-2 rounded bg-blue-600 text-white">
        {{ loading ? 'Saving...' : 'Save' }}
      </button>

       <!-- Surface API or validation errors from the component as plain text -->
      <span class="text-red-600" *ngIf="error">{{ error }}</span>
    </div>
  </form>
</section>
